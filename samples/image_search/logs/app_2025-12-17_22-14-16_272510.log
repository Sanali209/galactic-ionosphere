2025-12-17 22:14:16.274 | INFO     | src.core.logging:setup_logging:22 - Logging initialized.
2025-12-17 22:14:16.275 | INFO     | __main__:main:76 - ============================================================
2025-12-17 22:14:16.275 | INFO     | __main__:main:77 - Image Search Application Starting
2025-12-17 22:14:16.275 | INFO     | __main__:main:78 - ============================================================
2025-12-17 22:14:16.276 | INFO     | src.core.locator:init:36 - ServiceLocator initialized.
2025-12-17 22:14:16.289 | INFO     | src.core.database.manager:connect:22 - Connected to MongoDB at mongodb://localhost:27017, DB: image_search_db
2025-12-17 22:14:16.290 | DEBUG    | src.core.locator:register_system:45 - Registering system: CommandBus
2025-12-17 22:14:16.290 | DEBUG    | src.core.locator:register_system:45 - Registering system: JournalService
2025-12-17 22:14:16.290 | DEBUG    | src.core.locator:register_system:45 - Registering system: AssetManager
2025-12-17 22:14:16.291 | DEBUG    | src.core.locator:register_system:45 - Registering system: TaskSystem
2025-12-17 22:14:16.291 | DEBUG    | src.core.locator:register_system:45 - Registering system: SearchService
2025-12-17 22:14:16.291 | INFO     | src.core.locator:start_all:62 - Starting all systems...
2025-12-17 22:14:16.291 | INFO     | src.core.commands.bus:initialize:15 - CommandBus initialized.
2025-12-17 22:14:16.292 | INFO     | src.core.locator:start_all:66 - System CommandBus started.
2025-12-17 22:14:16.292 | INFO     | src.core.journal.service:initialize:11 - JournalService initialized.
2025-12-17 22:14:16.292 | INFO     | src.core.locator:start_all:66 - System JournalService started.
2025-12-17 22:14:16.292 | INFO     | src.core.assets.manager:initialize:17 - AssetManager initialized.
2025-12-17 22:14:16.293 | INFO     | src.core.locator:start_all:66 - System AssetManager started.
2025-12-17 22:14:16.293 | INFO     | src.core.tasks.system:initialize:19 - TaskSystem initializing...
2025-12-17 22:14:16.295 | WARNING  | src.core.tasks.system:initialize:25 - Found 1 interrupted tasks. Rescheduling...
2025-12-17 22:14:16.298 | INFO     | src.core.tasks.system:initialize:35 - Loaded 1 pending tasks.
2025-12-17 22:14:16.299 | INFO     | src.core.locator:start_all:66 - System TaskSystem started.
2025-12-17 22:14:16.299 | INFO     | app_search_service:initialize:31 - SearchService initialized
2025-12-17 22:14:16.299 | INFO     | src.core.locator:start_all:66 - System SearchService started.
2025-12-17 22:14:16.300 | INFO     | src.ui.menus.action_registry:__init__:17 - ActionRegistry initialized
2025-12-17 22:14:16.300 | INFO     | src.ui.docking.dock_manager:__init__:50 - DockManager initialized
2025-12-17 22:14:16.311 | INFO     | src.ui.menus.menu_builder:__init__:16 - MenuBuilder initialized
2025-12-17 22:14:16.629 | DEBUG    | src.ui.docking.dock_manager:register_panel:59 - Panel registered: search
2025-12-17 22:14:16.630 | DEBUG    | src.ui.docking.dock_manager:register_panel:59 - Panel registered: gallery
2025-12-17 22:14:16.631 | DEBUG    | src.ui.docking.panel_base:__init__:29 - Panel created: search
2025-12-17 22:14:16.638 | INFO     | src.ui.docking.dock_manager:create_panel:92 - Panel created: search
2025-12-17 22:14:16.639 | DEBUG    | src.ui.docking.panel_base:__init__:29 - Panel created: gallery
2025-12-17 22:14:16.642 | DEBUG    | src.ui.menus.action_registry:register_action:56 - Action registered: file_new_search
2025-12-17 22:14:16.642 | DEBUG    | src.ui.menus.action_registry:register_action:56 - Action registered: file_open_downloads
2025-12-17 22:14:16.642 | DEBUG    | src.ui.menus.action_registry:register_action:56 - Action registered: file_exit
2025-12-17 22:14:16.643 | DEBUG    | src.ui.menus.action_registry:register_action:56 - Action registered: edit_select_all
2025-12-17 22:14:16.643 | DEBUG    | src.ui.menus.action_registry:register_action:56 - Action registered: edit_deselect_all
2025-12-17 22:14:16.643 | DEBUG    | src.ui.menus.action_registry:register_action:56 - Action registered: search_images
2025-12-17 22:14:16.644 | DEBUG    | src.ui.menus.action_registry:register_action:56 - Action registered: download_selected
2025-12-17 22:14:16.645 | DEBUG    | src.ui.menus.action_registry:register_action:56 - Action registered: download_all
2025-12-17 22:14:16.645 | INFO     | app_main_window:__init__:39 - Image Search MainWindow initialized
2025-12-17 22:14:16.807 | INFO     | __main__:main:106 - Application started successfully
2025-12-17 22:14:16.879 | DEBUG    | src.core.tasks.system:_worker:90 - Worker 0 started.
2025-12-17 22:14:16.880 | DEBUG    | src.core.tasks.system:_worker:90 - Worker 1 started.
2025-12-17 22:14:16.881 | DEBUG    | src.core.tasks.system:_worker:90 - Worker 2 started.
2025-12-17 22:14:16.884 | ERROR    | app_main_window:_load_latest_results:226 - Failed to load results: CollectionRecord.find() got an unexpected keyword argument 'limit'
2025-12-17 22:14:16.885 | ERROR    | app_main_window:_load_latest_results:227 - Traceback:
Traceback (most recent call last):

  File "D:\github\USCore\samples\image_search\main.py", line 118, in <module>
    loop.run_until_complete(main())
    â”‚    â”‚                  â”” <function main at 0x00000193CF2AE840>
    â”‚    â”” <function _QEventLoop.run_until_complete at 0x00000193CDF06D40>
    â”” <QIOCPEventLoop running=True closed=False debug=False>

  File "D:\github\USCore\.venv\Lib\site-packages\qasync\__init__.py", line 428, in run_until_complete
    self.run_forever()
    â”‚    â”” <function _QEventLoop.run_forever at 0x00000193CDF06CA0>
    â”” <QIOCPEventLoop running=True closed=False debug=False>
  File "D:\github\USCore\.venv\Lib\site-packages\qasync\__init__.py", line 404, in run_forever
    rslt = self.__app.exec()
           â”” <QIOCPEventLoop running=True closed=False debug=False>
  File "D:\github\USCore\.venv\Lib\site-packages\qasync\__init__.py", line 307, in timerEvent
    handle._run()
    â”‚      â”” <function Handle._run at 0x00000193CD772840>
    â”” <Handle <TaskStepMethWrapper object at 0x00000193D193A470>()>
  File "C:\Users\User\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
    â”‚    â”‚            â”‚    â”‚           â”‚    â”” <member '_args' of 'Handle' objects>
    â”‚    â”‚            â”‚    â”‚           â”” <Handle <TaskStepMethWrapper object at 0x00000193D193A470>()>
    â”‚    â”‚            â”‚    â”” <member '_callback' of 'Handle' objects>
    â”‚    â”‚            â”” <Handle <TaskStepMethWrapper object at 0x00000193D193A470>()>
    â”‚    â”” <member '_context' of 'Handle' objects>
    â”” <Handle <TaskStepMethWrapper object at 0x00000193D193A470>()>

> File "D:\github\USCore\samples\image_search\src\ui\main_window.py", line 212, in _load_latest_results
    images = await ImageRecord.find({}, limit=100)
                   â”‚           â”” <classmethod(<function CollectionRecord.find at 0x00000193CF287240>)>
                   â”” <class 'app_image_record.ImageRecord'>

TypeError: CollectionRecord.find() got an unexpected keyword argument 'limit'
2025-12-17 22:14:24.535 | INFO     | app_search_panel:_on_search_clicked:88 - Search requested: 'cats' (count: 20)
2025-12-17 22:14:24.536 | INFO     | app_main_window:_execute_search:139 - Executing search: 'cats' (count: 20)
2025-12-17 22:14:24.543 | DEBUG    | src.core.tasks.system:register_handler:55 - Registered task handler: search_images
2025-12-17 22:14:24.553 | INFO     | src.core.tasks.system:submit:83 - Task submitted: Search: cats (69430f200c4c7b8fdcf4959e)
2025-12-17 22:14:24.554 | INFO     | app_main_window:_run_search:178 - Search task submitted successfully
2025-12-17 22:14:24.558 | INFO     | app_search_task:search_images_handler:22 - ğŸš€ Search handler started: 'cats' (count: 20)
2025-12-17 22:14:24.558 | DEBUG    | app_search_task:search_images_handler:27 - Converted count to integer: 20
2025-12-17 22:14:24.559 | DEBUG    | app_search_task:search_images_handler:30 - Getting SearchService from ServiceLocator...
2025-12-17 22:14:24.560 | DEBUG    | app_search_task:search_images_handler:37 - âœ… SearchService retrieved
2025-12-17 22:14:24.560 | INFO     | app_search_task:search_images_handler:40 - ğŸ” Executing search via SearchService...
2025-12-17 22:14:24.561 | INFO     | app_search_service:search_images:44 - ğŸ” Starting image search: 'cats' (max: 20)
2025-12-17 22:14:24.561 | DEBUG    | app_search_service:search_images:47 - Importing duckduckgo_search module...
2025-12-17 22:14:24.621 | DEBUG    | app_search_service:search_images:49 - âœ… duckduckgo_search imported successfully
2025-12-17 22:14:24.621 | INFO     | app_search_service:search_images:53 - ğŸ“¡ Calling DuckDuckGo API...
2025-12-17 22:14:25.941 | ERROR    | app_search_service:search_images:80 - âŒ Search failed: https://duckduckgo.com/i.js?o=json&q=cats&l=us-en&vqd=4-261929181247478834519421882535952110021&p=1&f=%2C%2C%2C%2C%2C 403 Ratelimit
2025-12-17 22:14:25.941 | ERROR    | app_search_service:search_images:81 - Full traceback:
Traceback (most recent call last):

  File "D:\github\USCore\samples\image_search\main.py", line 121, in <module>
    loop.run_forever()
    â”‚    â”” <function _QEventLoop.run_forever at 0x00000193CDF06CA0>
    â”” <QIOCPEventLoop running=True closed=False debug=False>

  File "D:\github\USCore\.venv\Lib\site-packages\qasync\__init__.py", line 404, in run_forever
    rslt = self.__app.exec()
           â”” <QIOCPEventLoop running=True closed=False debug=False>
  File "D:\github\USCore\.venv\Lib\site-packages\qasync\__init__.py", line 307, in timerEvent
    handle._run()
    â”‚      â”” <function Handle._run at 0x00000193CD772840>
    â”” <Handle Task.task_wakeup(<Future finis...wledged=True)>)>
  File "C:\Users\User\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
    â”‚    â”‚            â”‚    â”‚           â”‚    â”” <member '_args' of 'Handle' objects>
    â”‚    â”‚            â”‚    â”‚           â”” <Handle Task.task_wakeup(<Future finis...wledged=True)>)>
    â”‚    â”‚            â”‚    â”” <member '_callback' of 'Handle' objects>
    â”‚    â”‚            â”” <Handle Task.task_wakeup(<Future finis...wledged=True)>)>
    â”‚    â”” <member '_context' of 'Handle' objects>
    â”” <Handle Task.task_wakeup(<Future finis...wledged=True)>)>

  File "D:\github\USCore\templates\foundation\src\core\tasks\system.py", line 114, in _worker
    result = await handler(*record.task_args)
                   â”‚        â”‚      â”” <src.core.database.orm.ListField object at 0x00000193CF2B0C10>
                   â”‚        â”” <src.core.tasks.models.TaskRecord object at 0x00000193D1961D90>
                   â”” <function search_images_handler at 0x00000193D194BCE0>

  File "D:\github\USCore\samples\image_search\src\tasks\search_task.py", line 41, in search_images_handler
    results = await search_service.search_images(query, count_int)
                    â”‚              â”‚             â”‚      â”” 20
                    â”‚              â”‚             â”” 'cats'
                    â”‚              â”” <function SearchService.search_images at 0x00000193CF2AE700>
                    â”” <app_search_service.SearchService object at 0x00000193D04115D0>

> File "D:\github\USCore\samples\image_search\src\core\search_service.py", line 56, in search_images
    search_results = ddgs.images(query, max_results=max_results)
                     â”‚    â”‚      â”‚                  â”” 20
                     â”‚    â”‚      â”” 'cats'
                     â”‚    â”” <function DDGS.images at 0x00000193D4A5A0C0>
                     â”” <duckduckgo_search.duckduckgo_search.DDGS object at 0x00000193D0894050>

  File "D:\github\USCore\.venv\Lib\site-packages\duckduckgo_search\duckduckgo_search.py", line 502, in images
    resp_content = self._get_url(
                   â”‚    â”” <function DDGS._get_url at 0x00000193D4A59D00>
                   â”” <duckduckgo_search.duckduckgo_search.DDGS object at 0x00000193D0894050>
  File "D:\github\USCore\.venv\Lib\site-packages\duckduckgo_search\duckduckgo_search.py", line 138, in _get_url
    raise RatelimitException(f"{resp.url} {resp.status_code} Ratelimit")
          â”” <class 'duckduckgo_search.exceptions.RatelimitException'>

duckduckgo_search.exceptions.RatelimitException: https://duckduckgo.com/i.js?o=json&q=cats&l=us-en&vqd=4-261929181247478834519421882535952110021&p=1&f=%2C%2C%2C%2C%2C 403 Ratelimit
2025-12-17 22:14:25.949 | INFO     | app_search_task:search_images_handler:43 - ğŸ“Š Search returned 0 results
2025-12-17 22:14:25.949 | DEBUG    | app_search_task:search_images_handler:46 - Creating SearchHistory record...
2025-12-17 22:14:25.951 | INFO     | app_search_task:search_images_handler:54 - ğŸ’¾ Search history saved: 69430f210c4c7b8fdcf4959f
2025-12-17 22:14:25.951 | DEBUG    | app_search_task:search_images_handler:57 - Saving 0 image records to MongoDB...
2025-12-17 22:14:25.951 | INFO     | app_search_task:search_images_handler:71 - âœ… Successfully saved 0 image records to database
2025-12-17 22:14:25.952 | INFO     | app_search_task:search_images_handler:72 - ğŸ‰ Search complete! Query: 'cats', Results: 0
2025-12-17 22:14:26.547 | ERROR    | app_main_window:_load_latest_results:226 - Failed to load results: CollectionRecord.find() got an unexpected keyword argument 'sort'
2025-12-17 22:14:26.547 | ERROR    | app_main_window:_load_latest_results:227 - Traceback:
Traceback (most recent call last):

  File "D:\github\USCore\samples\image_search\main.py", line 121, in <module>
    loop.run_forever()
    â”‚    â”” <function _QEventLoop.run_forever at 0x00000193CDF06CA0>
    â”” <QIOCPEventLoop running=True closed=False debug=False>

  File "D:\github\USCore\.venv\Lib\site-packages\qasync\__init__.py", line 404, in run_forever
    rslt = self.__app.exec()
           â”” <QIOCPEventLoop running=True closed=False debug=False>
  File "D:\github\USCore\.venv\Lib\site-packages\qasync\__init__.py", line 307, in timerEvent
    handle._run()
    â”‚      â”” <function Handle._run at 0x00000193CD772840>
    â”” <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\User\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
    â”‚    â”‚            â”‚    â”‚           â”‚    â”” <member '_args' of 'Handle' objects>
    â”‚    â”‚            â”‚    â”‚           â”” <Handle Task.task_wakeup(<Future finished result=None>)>
    â”‚    â”‚            â”‚    â”” <member '_callback' of 'Handle' objects>
    â”‚    â”‚            â”” <Handle Task.task_wakeup(<Future finished result=None>)>
    â”‚    â”” <member '_context' of 'Handle' objects>
    â”” <Handle Task.task_wakeup(<Future finished result=None>)>

  File "D:\github\USCore\samples\image_search\src\ui\main_window.py", line 184, in _run_search
    await self._load_latest_results(query)
          â”‚    â”‚                    â”” 'cats'
          â”‚    â”” <function MainWindow._load_latest_results at 0x00000193CE0A56C0>
          â”” <app_main_window.MainWindow(0x193cd920d20) at 0x00000193D0413E40>

> File "D:\github\USCore\samples\image_search\src\ui\main_window.py", line 204, in _load_latest_results
    searches = await SearchHistory.find({"query": query}, sort=[("timestamp", -1)], limit=1)
                     â”‚             â”‚              â”” 'cats'
                     â”‚             â”” <classmethod(<function CollectionRecord.find at 0x00000193CF287240>)>
                     â”” <class 'app_search_history.SearchHistory'>

TypeError: CollectionRecord.find() got an unexpected keyword argument 'sort'
